ARG OWNER
ARG BASE_CONTAINER
ARG ROS_DISTRO=humble
ARG ROOT_CONTAINER=$OWNER/$BASE_CONTAINER 

FROM $ROOT_CONTAINER
ARG CONTAINER_PROJECT_ENV_NAME
ARG CONTAINER_PROJECT_FOLDER_NAME
ENV CONTAINER_PROJECT_DIR=${PROJECTS_DIR}/${CONTAINER_PROJECT_FOLDER_NAME}
ENV CONTAINER_PROJECT_ENV_NAME=${CONTAINER_PROJECT_ENV_NAME}

USER root
RUN mkdir -p ${CONTAINER_PROJECT_DIR}
COPY --chown=${MY_USER}:${MY_USER} . ${CONTAINER_PROJECT_DIR}
RUN /bin/bash -c "cd $CONTAINER_PROJECT_DIR; make clean"

USER ${MY_USER}
RUN sed -i 's^MY_PROJECT_DIR^'"${CONTAINER_PROJECT_ENV_NAME}"'='"${CONTAINER_PROJECT_DIR}"'^g' ~/.bashrc
RUN /bin/bash -c "cd $CONTAINER_PROJECT_DIR; make clean"

COPY --chown=${MY_USER}:${MY_USER} ./info.md ${CONTAINER_PROJECT_DIR}/info.md

USER ${MY_USER}
WORKDIR ${CONTAINER_PROJECT_DIR}
ENV HOME=${MY_HOME}
CMD /bin/bash
